inizio <- seq(1,720,24*7-1)[i]
fine <- seq(23,720,24*7-1)[i]
lun[i] <- out1$stops_by_each_hour[[inizio_fine]]
lun[i] <- out1$stops_by_each_hour[[inizio:fine]]
lun[i] <- out1$stops_by_each_hour[[1]][inizio:fine]
lun <- matrix(nrow = 5, ncol=24)
lun[i] <- out1$stops_by_each_hour[[1]][inizio:fine]
out1$stops_by_each_hour[[1]][inizio:fine]
fine <- seq(24,720,24*7-1)[i]
lun[i] <- out1$stops_by_each_hour[[1]][inizio:fine]
out1$stops_by_each_hour[[1]][inizio:fine]
stops[,92]
lun <- matrix(nrow = 5, ncol=24)
inizio <- seq(1,720,24*7-1)[i]
fine <- seq(24,720,24*7-1)[i]
lun[i] <- out1$stops_by_each_hour[[1]][inizio:fine]
lun[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
lun[i,]
lun <- matrix(nrow = 5, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7-1)[i]
fine <- seq(24,720,24*7-1)[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun
lun[4]
lun[4,]
stops[,92]
legend()
legend(col =my_col)
matplot(days,type='l', col = my_col, legend = levels(my_col)) #7 giorni settimanali, già fatta la media dentro popularity ...
x11()
matplot(days,type='l', col = my_col, legend = levels(my_col)) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("bottomright", col =my_col)
legend("bottomright", legend =my_col)
legend("bottomright", legend= days col = my_col)
legend("bottomright", legend= days, col = my_col)
x11()
matplot(days,type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= days, col = my_col)
x11()
matplot(days,type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= c('mon', 'tue','wed', 'thu', 'fri', 'sat', 'sun'), col = my_col)
x11()
matplot(days,type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= c('mon', 'tue','wed', 'thu', 'fri', 'sat', 'sun'), fill = my_col)
x11()
matplot(days[1,],type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= c('mon', 'tue','wed', 'thu', 'fri', 'sat', 'sun'), fill = my_col)
x11()
matplot(days[1,],type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= c('mon', 'tue','wed', 'thu', 'fri', 'sat', 'sun'), fill = my_col)
x11()
matplot(days[,1],type='l', col = my_col) #7 giorni settimanali, già fatta la media dentro popularity ...
legend("topleft", legend= c('mon', 'tue','wed', 'thu', 'fri', 'sat', 'sun'), fill = my_col)
seq(1,720,24*7-1)
seq(24,720,24*7-1)
lun[4,]
stops[,92]
lun <- matrix(nrow = 5, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun[4,]
seq(1,720,24*7)
seq(24,720,24*7)
mar <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
mar[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun <- matrix(nrow = 5, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun[4,]
mar <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
mar[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
mer <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
mer[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
gio <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
gio[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
ven <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
ven[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
sab <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
sab[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
dom <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
dom[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun <- t(lun)
mar <- t(mar)
mer <- t(mer)
gio <- t(gio)
ven <- t(ven)
sab <- t(sab)
dom <- t(dom)
x11()
matplot(lun,type='l')
library(RColorBrewer)
YiOrRd(7)
YIOrRd(7)
brewer.pal(n = 7, name = "YIOrRd")
display.brewer.pal(n = 7, name = "YIOrRd")
display.brewer.pal(n = 7, name = YIOrRd)
col = display.brewer.pal(n = 7, name = 'YIOrRd')
col = display.brewer.pal(n = 7, name = 'Set2')
col = display.brewer.pal(n = 7, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col)
col = display.brewer.pal(n = 5, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col)
col = brewer.pal(n = 5, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col)
col = brewer.pal(n = 5, name = 'Dark2')
x11()
matplot(lun,type='l', col = col)
col = brewer.pal(n = 4, name = 'YlGnBu')
x11()
matplot(mar,type='l', col = col)
x11()
matplot(mar,type='l', col = col, lwd =4)
x11()
matplot(lun,type='l', col = col[2:7])
col = brewer.pal(n = 7, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col[2:7])
col = brewer.pal(n = 8, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col[3:8])
col = brewer.pal(n = 8, name = 'YlGnBu')
col = brewer.pal(n = 8, name = 'YlGnBu')
x11()
matplot(mar,type='l', col = col[4:8])
col = brewer.pal(n = 8, name = 'YlGn')
x11()
matplot(mar,type='l', col = col[4:8])
matplot(mar,type='l', col = col[4:8], lwd=2)
col = brewer.pal(n = 8, name = 'RdPu')
x11()
col = brewer.pal(n = 8, name = 'YlGn')
x11()
matplot(mer,type='l', col = col[4:8], lwd=2)
inizio <- seq(1,720,24*7)[i] + 24
i<-1
inizio <- seq(1,720,24*7)[i] + 24
inizio <- seq(25,720,24*7)[i]
fine <- seq(48,720,24*7)[i]
seq(25,720,24*7)
seq(48,720,24*7)
24*3
seq(49,720,24*7)
seq(72,720,24*7)
seq(50,720,24*7)
seq(73,720,24*7)
24*4
24*5
seq(97,720,24*7)
seq(120,720,24*7)
24*6
seq(121,720,24*7)
seq(144,720,24*7)
inizio <- seq(1,720,24*7)
seq(1,720,24*7)
lun <- matrix(nrow = 5, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun[4,]
mar <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(25,720,24*7)[i]
fine <- seq(48,720,24*7)[i]
mar[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
mer <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(49,720,24*7)[i]
fine <- seq(72,720,24*7)[i]
mer[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
gio <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(50,720,24*7)[i]
fine <- seq(73,720,24*7)[i]
gio[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
ven <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(74,720,24*7)[i]
fine <- seq(96,720,24*7)[i]
ven[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
sab <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(97,720,24*7)[i]
fine <- seq(120,720,24*7)[i]
sab[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
dom <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(121,720,24*7)[i]
fine <- seq(144,720,24*7)[i]
dom[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
col = brewer.pal(n = 8, name = 'YlGn')
x11()
matplot(mer,type='l', col = col[4:8], lwd=2)
lun <- t(lun)
mar <- t(mar)
mer <- t(mer)
gio <- t(gio)
ven <- t(ven)
sab <- t(sab)
dom <- t(dom)
x11()
matplot(mer,type='l', col = col[4:8], lwd=2)
seq(1,720,24*7)
seq(24,720,24*7)
seq(25,720,24*7)
seq(48,720,24*7)
seq(49,720,24*7)
seq(72,720,24*7)
seq(50,720,24*7)
seq(73,720,24*7)
24*4
24*7
24*6
dom <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(145,720,24*7)[i]
fine <- seq(168,720,24*7)[i]
dom[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun <- matrix(nrow = 5, ncol=24)
for (i in 1:5){
inizio <- seq(1,720,24*7)[i]
fine <- seq(24,720,24*7)[i]
lun[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun[4,]
mar <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(25,720,24*7)[i]
fine <- seq(48,720,24*7)[i]
mar[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
mer <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(49,720,24*7)[i]
fine <- seq(72,720,24*7)[i]
mer[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
gio <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(73,720,24*7)[i]
fine <- seq(96,720,24*7)[i]
gio[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
ven <- matrix(nrow = 4, ncol=24)
for (i in 1:5){
inizio <- seq(97,720,24*7)[i]
fine <- seq(120,720,24*7)[i]
ven[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
sab <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(121,720,24*7)[i]
fine <- seq(144,720,24*7)[i]
sab[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
dom <- matrix(nrow = 4, ncol=24)
for (i in 1:4){
inizio <- seq(145,720,24*7)[i]
fine <- seq(168,720,24*7)[i]
dom[i,] <- out1$stops_by_each_hour[[1]][inizio:fine]
}
lun <- t(lun)
mar <- t(mar)
mer <- t(mer)
gio <- t(gio)
ven <- t(ven)
sab <- t(sab)
dom <- t(dom)
col = brewer.pal(n = 8, name = 'YlOrRd')
x11()
matplot(lun,type='l', col = col[3:8], lwd =2)
col = brewer.pal(n = 8, name = 'YlGnBu')
x11()
matplot(mar,type='l', col = col[4:8],  lwd =2)
col = brewer.pal(n = 8, name = 'YlGn')
x11()
matplot(mer,type='l', col = col[4:8], lwd=2)
col = brewer.pal(n = 8, name = 'RdPu')
x11()
matplot(mar,type='l', col = col[4:8], lwd=2)
matplot(gio,type='l', col = col[4:8], lwd=2)
col = brewer.pal(n = 8, name = 'OrRd')
x11()
matplot(ven,type='l', col = col[4:8], lwd=2)
col = brewer.pal(n = 8, name = 'Greens')
x11()
matplot(sab,type='l', col = col[4:8], lwd=2)
col = brewer.pal(n = 8, name = 'Blues')
x11()
matplot(dom,type='l', col = col[4:8], lwd=2)
library(fda)
library(ggplot2)
library(geosphere)
library(sf)
library(sp)           ## Data management
library(lattice)      ## Data management
library(geoR)         ## Geostatistics
library(gstat)        ## Geostatistics
library(raster)
library(rgdal)
# fra
load("C:/Users/franc/Desktop/PoliMI/Anno Accademico 2020-2021/Applied Statistics/Progetto/Applied-statistics-project/DATASET/NYC_no_river.RData")
load("C:/Users/franc/Desktop/PoliMI/Anno Accademico 2020-2021/Applied Statistics/Progetto/Applied-statistics-project/DATASET/CBG_NY_no_river.RData")
load("C:/Users/franc/Desktop/PoliMI/Anno Accademico 2020-2021/Applied Statistics/Progetto/Applied-statistics-project/DATASET/River_Dataset.RData")
#--------------------------------------------------------------------
# Build dataset
New_York_County_no_river=New_York_County_no_river[order(New_York_County_no_river$area),]
CBG_ny_no_river=CBG_ny_no_river[order(CBG_ny_no_river$CensusBlockGroup),]
attach(New_York_County_no_river)
stops<-matrix(nrow = 1092, ncol=30)
for (i in 1:dim(New_York_County_no_river)[1]) {
stops[i,]<-stops_by_day[[i]]
}
detach(New_York_County_no_river)
stops<-t(stops)
colnames(stops)<-New_York_County_no_river$area
x11()
matplot(stops,type='l' , main = "Stops by day")
#B-SPLINES
# Set parameters
nbasis <- 13
m <- 3+1        # spline order
# spline degree  #DEGREE = ORDER - 1
basis <- create.bspline.basis(rangeval=c(1,30), nbasis=nbasis, norder=m)
time=1:30
data_W.fd.1 <- Data2fd(y = stops,argvals = time,basisobj = basis) #SMOOTHING
x11()
plot.fd(data_W.fd.1, main ="Smoothing stops by day")
# FPCA
arm=5 #numero armoniche
plot.fd(data_W.fd.1)
pca_W.1 <- pca.fd(data_W.fd.1,nharm=arm,centerfns=TRUE) #build a functional object before run it -> smoothing preprocessing
# scree plot
# pca.fd computes all the 365 eigenvalues, but only the first are non null
plot(pca_W.1$values[1:5],xlab='j',ylab='Eigenvalues')
plot(cumsum(pca_W.1$values)[1:5]/sum(pca_W.1$values),xlab='j',ylab='CPV',ylim=c(0.8,1))
layout(cbind(1,2,3))
plot(pca_W.1$harmonics[1,],col=1,ylab='FPC1')
abline(h=0,lty=2)
plot(pca_W.1$harmonics[2,],col=2,ylab='FPC2')
plot(pca_W.1$harmonics[3,],col=2,ylab='FPC3')
par(mfrow=c(1,3))
plot.pca.fd(pca_W.1, nx=100, pointplot=TRUE, harm=c(1,2,3), expand=0, cycle=FALSE)
# scatter plot of the scores
par(mfrow=c(1,2))
plot(pca_W.1$scores[,1],pca_W.1$scores[,2],xlab="Scores FPC1",ylab="Scores FPC2",lwd=2)
plot(pca_W.1$scores[,1],pca_W.1$scores[,2],type="n",xlab="Scores FPC1",
ylab="Scores FPC2")
text(pca_W.1$scores[,1],pca_W.1$scores[,2], cex=1)
x11()
plot(pca_W.1$scores[,1],pca_W.1$scores[,2],type="n",xlab="Scores FPC1",
ylab="Scores FPC2", main="Scatterplot")
text(pca_W.1$scores[,1],pca_W.1$scores[,2], cex=1)
# outliers
out=c(92,532)
cbg_out=New_York_County_no_river[out,1]
layout(1)
x11()
matplot(stops,type='l', main= "Stops by day - outliers")
lines(stops[,92],lwd=4, col=2)
lines(stops[,532],lwd=4, col=1)
x11()
ggplot() +
geom_sf(data = CBG_ny_no_river$geometry, fill="cornsilk")+
geom_sf(data = CBG_ny_no_river$geometry[out], fill="chartreuse")+
geom_sf(data = CBG_RIVER$geometry, fill="lightblue")+
ggtitle("Influential Points")
# togliamo questi outliers
stops<-stops[,-out]
x11()
matplot(stops,type='l', main = "Stops by Day")
abscissa<-1:30
Xobs0<-stops
nbasis <- 22
basis <- create.fourier.basis(rangeval=c(1,30),nbasis=nbasis) # creates a fourier basis
time=1:30
data_W.fd.1 <- Data2fd(y = stops,argvals = time,basisobj = basis) #SMOOTHING
plot.fd(data_W.fd.1)
# FPCA
arm=5 #numero armoniche
pca_W.1 <- pca.fd(data_W.fd.1,nharm=arm,centerfns=TRUE) #build a functional object before run it -> smoothing preprocessing
# scree plot
# pca.fd computes all the 365 eigenvalues, but only the first are non null
plot(pca_W.1$values[1:5],xlab='j',ylab='Eigenvalues')
plot(cumsum(pca_W.1$values)[1:5]/sum(pca_W.1$values),xlab='j',ylab='CPV',ylim=c(0.8,1))
layout(cbind(1,2,3))
plot(pca_W.1$harmonics[1,],col=1,ylab='FPC1')
abline(h=0,lty=2)
plot(pca_W.1$harmonics[2,],col=2,ylab='FPC2')
plot(pca_W.1$harmonics[3,],col=2,ylab='FPC3')
par(mfrow=c(1,3))
plot.pca.fd(pca_W.1, nx=100, pointplot=TRUE, harm=c(1,2,3), expand=0, cycle=FALSE)
x11()
media <- mean.fd(data_W.fd.1)
par(mfrow=c(2,1))
plot(media,lwd=2,ylim=c(-20,300),ylab='Stops by day',main='FPC1')
lines(media+pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=3)
lines(media-pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=2)
abline(v=seq(1,30, by=7),lty=2)
title("FPC1")
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=3)
lines(media-pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC2")
# temperate climate or not
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=3)
lines(media-pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC3")
x11()
media <- mean.fd(data_W.fd.1)
par(mfrow=c(3,1))
plot(media,lwd=2,ylim=c(-20,300),ylab='Stops by day',main='FPC1')
lines(media+pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=3)
lines(media-pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=2)
abline(v=seq(1,30, by=7),lty=2)
title("FPC1")
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=3)
lines(media-pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC2")
# temperate climate or not
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=3)
lines(media-pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC3")
par(mfrow=c(1,3))
plot.pca.fd(pca_W.1, nx=100, pointplot=TRUE, harm=c(1,2,3), expand=0, cycle=FALSE)
x11()
media <- mean.fd(data_W.fd.1)
par(mfrow=c(3,1))
plot(media,lwd=2,ylim=c(-20,300),ylab='Stops by day',main='FPC1')
lines(media+pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=3)
lines(media-pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=2)
abline(v=seq(1,30, by=7),lty=2)
title("FPC1 - 93.5% of variability")
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=3)
lines(media-pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC2 - 2.4% of variability")
# temperate climate or not
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=3)
lines(media-pca_W.1$harmonics[3,]*sqrt(pca_W.1$values[3]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC3 - 1.3% of variability")
x11()
media <- mean.fd(data_W.fd.1)
par(mfrow=c(2,1))
plot(media,lwd=2,ylim=c(-20,300),ylab='Stops by day',main='FPC1')
lines(media+pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=3)
lines(media-pca_W.1$harmonics[1,]*sqrt(pca_W.1$values[1]), col=2)
abline(v=seq(1,30, by=7),lty=2)
title("FPC1 - 93.5% of variability")
plot(media,lwd=2,ylim=c(0,170),ylab='Stops by day',main='FPC2')
lines(media+pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=3)
lines(media-pca_W.1$harmonics[2,]*sqrt(pca_W.1$values[2]), col=2)
abline(v=seq(1,30, by=7), lty=2)
title("FPC2 - 2.4% of variability")
